<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accelerometer Data Sender</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --success: #4cc9f0;
      --danger: #f72585;
      --dark: #212529;
      --light: #f8f9fa;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      color: white;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      margin-bottom: 15px;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .card h2 {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card h2 i {
      font-size: 1.5rem;
    }
    
    .button-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }
    
    button {
      background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    button.stop {
      background: linear-gradient(to right, #ff416c, #ff4b2b);
    }
    
    .sensor-status {
      text-align: center;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      font-weight: bold;
      background: rgba(0, 0, 0, 0.2);
    }
    
    .status-active {
      background: rgba(46, 204, 113, 0.2);
      color: #2ecc71;
    }
    
    .status-inactive {
      background: rgba(231, 76, 60, 0.2);
      color: #e74c3c;
    }
    
    .data-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .data-box {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    
    .data-label {
      font-size: 1.1rem;
      margin-bottom: 10px;
      opacity: 0.8;
    }
    
    .data-value {
      font-size: 2rem;
      font-weight: bold;
    }
    
    .visualization {
      height: 200px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      margin: 20px 0;
      position: relative;
      overflow: hidden;
    }
    
    .ball {
      position: absolute;
      width: 40px;
      height: 40px;
      background: linear-gradient(to right, #4facfe, #00f2fe);
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: transform 0.1s ease-out;
      box-shadow: 0 0 20px #4facfe;
    }
    
    .instructions {
      margin-top: 30px;
    }
    
    .instructions ol {
      padding-left: 25px;
      margin: 15px 0;
      line-height: 1.8;
    }
    
    .instructions li {
      margin-bottom: 10px;
    }
    
    .firebase-info {
      background: rgba(255, 167, 38, 0.1);
      border-left: 4px solid #ffa726;
      padding: 15px;
      border-radius: 0 10px 10px 0;
      margin: 20px 0;
    }
    
    .debug-info {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 0.9rem;
      margin-top: 20px;
    }
    
    .magnitude {
      text-align: center;
      margin-top: 15px;
      font-size: 1.2rem;
    }
    
    .magnitude-value {
      font-weight: bold;
      color: #4cc9f0;
    }
    
    @media (max-width: 600px) {
      .button-container {
        flex-direction: column;
      }
      
      .data-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üì± Accelerometer Data Sender</h1>
      <p class="subtitle">Fixed Solution - Now with Proper Gravity Handling</p>
      <div class="sensor-status status-inactive" id="sensorStatus">
        <i>üî¥</i> Accelerometer: Inactive
      </div>
    </header>
    
    <main>
      <div class="card">
        <h2><i>‚öôÔ∏è</i> Control Panel</h2>
        <div class="button-container">
          <button id="startBtn">
            <i>üì≤</i> Start Sending Data
          </button>
          <button id="stopBtn" class="stop" disabled>
            <i>‚õî</i> Stop Sending
          </button>
        </div>
        
        <div class="firebase-info">
          <strong>Firebase Configuration:</strong>
          <p>Replace the placeholder config in the JavaScript with your Firebase project details.</p>
        </div>
      </div>
      
      <div class="card">
        <h2><i>üìä</i> Live Data</h2>
        <div class="data-container">
          <div class="data-box">
            <div class="data-label">X-Axis</div>
            <div id="xValue" class="data-value">0.00</div>
            <div>g-force</div>
          </div>
          <div class="data-box">
            <div class="data-label">Y-Axis</div>
            <div id="yValue" class="data-value">0.00</div>
            <div>g-force</div>
          </div>
          <div class="data-box">
            <div class="data-label">Z-Axis</div>
            <div id="zValue" class="data-value">0.00</div>
            <div>g-force</div>
          </div>
        </div>
        
        <div class="magnitude">
          Magnitude: <span id="magnitudeValue" class="magnitude-value">0.00</span> g
        </div>
        
        <div class="visualization">
          <div class="ball" id="accelBall"></div>
        </div>
        
        <div id="output" class="sensor-status">
          <div>No data being sent</div>
          <div>Last sent: Never</div>
        </div>
      </div>
      
      <div class="card">
        <h2><i>üîß</i> Fix Details</h2>
        <div class="debug-info">
          <p><strong>Fixed Issue:</strong> Proper handling of gravity compensation</p>
          <p><strong>Solution:</strong> Using <code>accelerationIncludingGravity</code> instead of <code>acceleration</code></p>
          <p><strong>Key Changes:</strong></p>
          <ul>
            <li>Corrected event property to <code>event.accelerationIncludingGravity</code></li>
            <li>Added gravity magnitude calculation</li>
            <li>Enhanced error handling for sensor access</li>
            <li>Improved UI with real-time visualization</li>
          </ul>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Firebase configuration - REPLACE WITH YOUR OWN CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyCtj_5WJSZBd_OyQTnvRxHp86jq3wm_nC4",
      authDomain: "gym-assistant-c17bf.firebaseapp.com",
      databaseURL: "https://gym-assistant-c17bf-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "gym-assistant-c17bf",
      storageBucket: "gym-assistant-c17bf.appspot.com",
      messagingSenderId: "662303418266",
      appId: "1:662303418266:web:2782db3eaf66826788fc23",
      measurementId: "G-VMW0CLK3F3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // DOM Elements
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const sensorStatus = document.getElementById('sensorStatus');
    const outputDiv = document.getElementById('output');
    const xValue = document.getElementById('xValue');
    const yValue = document.getElementById('yValue');
    const zValue = document.getElementById('zValue');
    const magnitudeValue = document.getElementById('magnitudeValue');
    const accelBall = document.getElementById('accelBall');

    // State variables
    let isSending = false;
    let lastSent = 0;
    let lastData = { x: 0, y: 0, z: 0 };

    function updateBallPosition(x, y) {
      // Convert g-force values to pixel offsets (1g ‚âà 50px)
      const posX = x * 50;
      const posY = y * 50;
      
      // Limit movement to container boundaries
      const container = accelBall.parentElement;
      const maxX = (container.clientWidth - accelBall.clientWidth) / 2;
      const maxY = (container.clientHeight - accelBall.clientHeight) / 2;
      
      const boundedX = Math.max(Math.min(posX, maxX), -maxX);
      const boundedY = Math.max(Math.min(posY, maxY), -maxY);
      
      accelBall.style.transform = `translate(calc(-50% + ${boundedX}px), calc(-50% + ${boundedY}px))`;
    }

    function updateUI(acc, now) {
      if (!acc) return;
      
      // Update values display
      const x = acc.x || 0;
      const y = acc.y || 0;
      const z = acc.z || 0;
      
      xValue.textContent = x.toFixed(2);
      yValue.textContent = y.toFixed(2);
      zValue.textContent = z.toFixed(2);
      
      // Calculate magnitude
      const magnitude = Math.sqrt(x*x + y*y + z*z).toFixed(2);
      magnitudeValue.textContent = magnitude;
      
      // Update ball position based on X and Y acceleration
      updateBallPosition(x, y);
      
      // Update output display
      outputDiv.innerHTML = `
        <div><b>Last sent data:</b></div>
        <div><b>x:</b> ${x.toFixed(2)}, <b>y:</b> ${y.toFixed(2)}, <b>z:</b> ${z.toFixed(2)}</div>
        <div><b>Time:</b> ${new Date(now).toLocaleTimeString()}</div>
        <div><b>Magnitude:</b> ${magnitude} g</div>
      `;
    }

    function startListening() {
      if (isSending) return;
      
      window.addEventListener('devicemotion', handleMotionEvent);
      isSending = true;
      startBtn.disabled = true;
      stopBtn.disabled = false;
      sensorStatus.innerHTML = '<i>üü¢</i> Accelerometer: Active (sending data)';
      sensorStatus.className = 'sensor-status status-active';
      
      outputDiv.innerHTML = '<div>Listening for motion data...</div>';
    }

    function handleMotionEvent(event) {
      // FIXED: Using accelerationIncludingGravity instead of acceleration
      const acc = event.accelerationIncludingGravity;
      const now = Date.now();
      
      // Always update UI for smooth visualization
      updateUI(acc, now);
      
      // Only send to Firebase once per second
      if (now - lastSent > 1000) {
        lastSent = now;
        lastData = { 
          x: acc.x || 0, 
          y: acc.y || 0, 
          z: acc.z || 0 
        };
        
        // Send data to Firebase
        db.ref("accelerationData").push({
          x: lastData.x,
          y: lastData.y,
          z: lastData.z,
          time: now
        }).catch(error => {
          outputDiv.innerHTML += `<div style="color: var(--danger)">Firebase Error: ${error.message}</div>`;
        });
      }
    }

    function stopSending() {
      if (!isSending) return;
      
      window.removeEventListener('devicemotion', handleMotionEvent);
      isSending = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      sensorStatus.innerHTML = '<i>üî¥</i> Accelerometer: Inactive';
      sensorStatus.className = 'sensor-status status-inactive';
      
      outputDiv.innerHTML = '<div>Data sending stopped</div>';
    }

    function requestSensorPermission() {
      // Check if the browser supports the permission API
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              startListening();
            } else {
              alert("Permission denied. Cannot access motion sensors.");
              outputDiv.innerHTML = '<div style="color: var(--danger)">Permission denied to access sensors</div>';
            }
          })
          .catch(error => {
            console.error("Permission error:", error);
            outputDiv.innerHTML = `<div style="color: var(--danger)">Error: ${error.message}</div>`;
          });
      } else {
        // Android devices or browsers without permission API
        startListening();
      }
    }

    // Initialize UI state
    startBtn.addEventListener('click', requestSensorPermission);
    stopBtn.addEventListener('click', stopSending);
    
    // Display Firebase config status
    if (firebaseConfig.apiKey === "YOUR_API_KEY") {
      outputDiv.innerHTML = `
        <div style="color: var(--danger); font-weight: bold">
          ‚ö†Ô∏è Firebase not configured! Replace config values in the code.
        </div>
      `;
    }
  </script>
</body>
</html>